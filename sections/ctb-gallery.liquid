{% stylesheet %}
  .ctb-gallery {
    background: {{ section.settings.background_color }};
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px 0;
    color: {{ section.settings.text_color }};
  }

  .ctb-gallery__inner {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .ctb-gallery__title {
    text-align: center;
    color: {{ section.settings.heading_color }};
    font-size: clamp(2rem, 4vw, 3rem);
    margin: 0 0 0.75rem 0;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .ctb-gallery__subtitle {
    text-align: center;
    color: {{ section.settings.subtext_color }};
    margin: 0 0 2.5rem 0;
    font-size: 1.05rem;
    max-width: 760px;
    margin-left: auto;
    margin-right: auto;
  }

  .ctb-gallery__carousel {
    margin: 0 -10px;
  }

  .ctb-gallery__item {
    position: relative;
    padding-bottom: 70%;
    border-radius: 10px;
    overflow: hidden;
    background: #0f0f0f;
    border: 1px solid rgba(255, 255, 255, 0.05);
  }

  .ctb-gallery__item img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .ctb-gallery__item:hover img {
    transform: scale(1.05);
  }

  .ctb-gallery .splide__pagination__page.is-active {
    background: {{ section.settings.accent_color }};
  }

  .ctb-gallery .splide__arrow {
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.15);
    color: #f5f5f5;
  }

  .ctb-gallery .splide__arrow:hover {
    border-color: {{ section.settings.accent_color }};
    color: {{ section.settings.accent_color }};
  }

  @media (max-width: 768px) {
    .ctb-gallery {
      padding: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px 0 {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px 0;
    }
  }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    const slider = document.querySelector('#ctb-gallery-{{ section.id }} .ctb-gallery__carousel');
    if (!slider || typeof Splide === 'undefined') return;

    const perPage = {{ section.settings.items_per_page }};

    const splide = new Splide(slider, {
      type: 'loop',
      gap: '14px',
      perPage: perPage,
      pagination: true,
      arrows: true,
      autoplay: {{ section.settings.autoplay | json }},
      interval: {{ section.settings.autoplay_speed }},
      speed: 650,
      pauseOnHover: true,
      breakpoints: {
        1024: { perPage: Math.max(perPage - 1, 1) },
        768: { perPage: 1 }
      }
    });

    splide.mount();
  });
{% endjavascript %}

<section id="ctb-gallery-{{ section.id }}" class="ctb-gallery">
  <div class="ctb-gallery__inner">
    <h2 class="ctb-gallery__title">{{ section.settings.heading }}</h2>
    {% if section.settings.description != blank %}
      <p class="ctb-gallery__subtitle">{{ section.settings.description }}</p>
    {% endif %}

    <div class="ctb-gallery__carousel splide" aria-label="Gallery">
      <div class="splide__track">
        <ul class="splide__list">
          {% for block in section.blocks %}
            {% if block.type == 'image' and block.settings.image != blank %}
              <li class="splide__slide">
                <div class="ctb-gallery__item">
                  <img src="{{ block.settings.image | image_url: width: 1200 }}" alt="{{ block.settings.image.alt | default: 'Gallery image' }}" loading="lazy">
                </div>
              </li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "CTB Gallery (Black)",
  "settings": [
    {"type": "text", "id": "heading", "label": "Heading", "default": "Event Galleries"},
    {"type": "textarea", "id": "description", "label": "Description", "default": "Recent auto body work, builds, and event highlights."},
    {"type": "range", "id": "items_per_page", "label": "Items per view", "min": 1, "max": 5, "step": 1, "default": 3},
    {"type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false},
    {"type": "range", "id": "autoplay_speed", "min": 3000, "max": 10000, "step": 500, "unit": "ms", "label": "Autoplay speed", "default": 5000},
    {"type": "range", "id": "padding_top", "min": 20, "max": 140, "step": 10, "unit": "px", "label": "Padding Top", "default": 70},
    {"type": "range", "id": "padding_bottom", "min": 20, "max": 140, "step": 10, "unit": "px", "label": "Padding Bottom", "default": 70},
    {"type": "color", "id": "background_color", "label": "Background", "default": "#050505"},
    {"type": "color", "id": "heading_color", "label": "Heading Color", "default": "#f5f5f5"},
    {"type": "color", "id": "text_color", "label": "Text Color", "default": "#e6e6e6"},
    {"type": "color", "id": "subtext_color", "label": "Subtext Color", "default": "#bdbdbd"},
    {"type": "color", "id": "accent_color", "label": "Accent Color", "default": "#f5d76e"}
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Gallery Image",
      "settings": [
        {"type": "image_picker", "id": "image", "label": "Image"}
      ]
    }
  ],
  "presets": [
    {
      "name": "CTB Gallery (Black)",
      "blocks": [
        {"type": "image"},
        {"type": "image"},
        {"type": "image"},
        {"type": "image"}
      ]
    }
  ]
}
{% endschema %}
