{% comment %}
  Custom Font Override Section
  Allows you to load custom fonts and apply them to specific elements with custom styling
  Block-based: Add multiple font overrides for different selectors
{% endcomment %}

{% comment %} Load all font files/stylesheets {% endcomment %}
{% for block in section.blocks %}
  {% comment %} Desktop Font {% endcomment %}
  {% if block.settings.font_url != blank %}
    {% assign is_font_file = false %}
    {% if block.settings.font_url contains '.woff' or block.settings.font_url contains '.ttf' or block.settings.font_url contains '.otf' %}
      {% assign is_font_file = true %}
    {% endif %}

    {% if is_font_file %}
      <style>
        @font-face {
          font-family: "{{ block.settings.font_family_name }}";
          {% if block.settings.font_url contains '.woff2' %}
            src: url("{{ block.settings.font_url }}") format("woff2");
          {% elsif block.settings.font_url contains '.woff' %}
            src: url("{{ block.settings.font_url }}") format("woff");
          {% elsif block.settings.font_url contains '.ttf' %}
            src: url("{{ block.settings.font_url }}") format("truetype");
          {% elsif block.settings.font_url contains '.otf' %}
            src: url("{{ block.settings.font_url }}") format("opentype");
          {% endif %}
          font-display: swap;
        }
      </style>
    {% else %}
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="{{ block.settings.font_url }}" rel="stylesheet">
    {% endif %}
  {% endif %}

  {% comment %} Tablet Font {% endcomment %}
  {% if block.settings.font_url_tablet != blank %}
    {% assign is_font_file_tablet = false %}
    {% if block.settings.font_url_tablet contains '.woff' or block.settings.font_url_tablet contains '.ttf' or block.settings.font_url_tablet contains '.otf' %}
      {% assign is_font_file_tablet = true %}
    {% endif %}

    {% if is_font_file_tablet %}
      <style>
        @font-face {
          font-family: "{{ block.settings.font_family_name_tablet }}";
          {% if block.settings.font_url_tablet contains '.woff2' %}
            src: url("{{ block.settings.font_url_tablet }}") format("woff2");
          {% elsif block.settings.font_url_tablet contains '.woff' %}
            src: url("{{ block.settings.font_url_tablet }}") format("woff");
          {% elsif block.settings.font_url_tablet contains '.ttf' %}
            src: url("{{ block.settings.font_url_tablet }}") format("truetype");
          {% elsif block.settings.font_url_tablet contains '.otf' %}
            src: url("{{ block.settings.font_url_tablet }}") format("opentype");
          {% endif %}
          font-display: swap;
        }
      </style>
    {% else %}
      <link href="{{ block.settings.font_url_tablet }}" rel="stylesheet">
    {% endif %}
  {% endif %}

  {% comment %} Mobile Landscape Font {% endcomment %}
  {% if block.settings.font_url_mobile_landscape != blank %}
    {% assign is_font_file_mobile_l = false %}
    {% if block.settings.font_url_mobile_landscape contains '.woff' or block.settings.font_url_mobile_landscape contains '.ttf' or block.settings.font_url_mobile_landscape contains '.otf' %}
      {% assign is_font_file_mobile_l = true %}
    {% endif %}

    {% if is_font_file_mobile_l %}
      <style>
        @font-face {
          font-family: "{{ block.settings.font_family_name_mobile_landscape }}";
          {% if block.settings.font_url_mobile_landscape contains '.woff2' %}
            src: url("{{ block.settings.font_url_mobile_landscape }}") format("woff2");
          {% elsif block.settings.font_url_mobile_landscape contains '.woff' %}
            src: url("{{ block.settings.font_url_mobile_landscape }}") format("woff");
          {% elsif block.settings.font_url_mobile_landscape contains '.ttf' %}
            src: url("{{ block.settings.font_url_mobile_landscape }}") format("truetype");
          {% elsif block.settings.font_url_mobile_landscape contains '.otf' %}
            src: url("{{ block.settings.font_url_mobile_landscape }}") format("opentype");
          {% endif %}
          font-display: swap;
        }
      </style>
    {% else %}
      <link href="{{ block.settings.font_url_mobile_landscape }}" rel="stylesheet">
    {% endif %}
  {% endif %}

  {% comment %} Mobile Portrait Font {% endcomment %}
  {% if block.settings.font_url_mobile_portrait != blank %}
    {% assign is_font_file_mobile_p = false %}
    {% if block.settings.font_url_mobile_portrait contains '.woff' or block.settings.font_url_mobile_portrait contains '.ttf' or block.settings.font_url_mobile_portrait contains '.otf' %}
      {% assign is_font_file_mobile_p = true %}
    {% endif %}

    {% if is_font_file_mobile_p %}
      <style>
        @font-face {
          font-family: "{{ block.settings.font_family_name_mobile_portrait }}";
          {% if block.settings.font_url_mobile_portrait contains '.woff2' %}
            src: url("{{ block.settings.font_url_mobile_portrait }}") format("woff2");
          {% elsif block.settings.font_url_mobile_portrait contains '.woff' %}
            src: url("{{ block.settings.font_url_mobile_portrait }}") format("woff");
          {% elsif block.settings.font_url_mobile_portrait contains '.ttf' %}
            src: url("{{ block.settings.font_url_mobile_portrait }}") format("truetype");
          {% elsif block.settings.font_url_mobile_portrait contains '.otf' %}
            src: url("{{ block.settings.font_url_mobile_portrait }}") format("opentype");
          {% endif %}
          font-display: swap;
        }
      </style>
    {% else %}
      <link href="{{ block.settings.font_url_mobile_portrait }}" rel="stylesheet">
    {% endif %}
  {% endif %}
{% endfor %}

{% comment %} Apply font styles to target elements {% endcomment %}
<style>
  {% for block in section.blocks %}
    {% if block.settings.font_url != blank %}
      {% assign font_name = block.settings.font_family_name %}
      {% assign targets = block.settings.target_elements | split: ',' %}
      
      {% comment %} Desktop styles (default) {% endcomment %}
      {% for target in targets %}
        {{ target | strip }} {
          font-family: "{{ font_name }}", {{ block.settings.fallback_font }} !important;
          {% if block.settings.font_size != blank and block.settings.font_size > 10 %}
            font-size: {{ block.settings.font_size }}px !important;
          {% endif %}
          {% if block.settings.line_height != blank and block.settings.line_height != 1.5 %}
            line-height: {{ block.settings.line_height }} !important;
          {% endif %}
          {% if block.settings.letter_spacing != blank and block.settings.letter_spacing != 0 %}
            letter-spacing: {{ block.settings.letter_spacing }}px !important;
          {% endif %}
          {% if block.settings.font_weight != blank %}
            font-weight: {{ block.settings.font_weight }} !important;
          {% endif %}
          {% if block.settings.text_transform != blank and block.settings.text_transform != 'none' %}
            text-transform: {{ block.settings.text_transform }} !important;
          {% endif %}
        }
      {% endfor %}

      {% comment %} Tablet styles (max-width: 991px) {% endcomment %}
      @media (max-width: 991px) {
        {% for target in targets %}
          {{ target | strip }} {
            {% if block.settings.font_url_tablet != blank and block.settings.font_family_name_tablet != blank %}
              font-family: "{{ block.settings.font_family_name_tablet }}", {{ block.settings.fallback_font }} !important;
            {% endif %}
            {% if block.settings.font_size_tablet != blank and block.settings.font_size_tablet > 10 %}
              font-size: {{ block.settings.font_size_tablet }}px !important;
            {% endif %}
            {% if block.settings.line_height_tablet != blank and block.settings.line_height_tablet != 1.5 %}
              line-height: {{ block.settings.line_height_tablet }} !important;
            {% endif %}
            {% if block.settings.letter_spacing_tablet != blank %}
              letter-spacing: {{ block.settings.letter_spacing_tablet }}px !important;
            {% endif %}
            {% if block.settings.font_weight_tablet != blank %}
              font-weight: {{ block.settings.font_weight_tablet }} !important;
            {% endif %}
          }
        {% endfor %}
      }

      {% comment %} Mobile Landscape (max-width: 767px) {% endcomment %}
      @media (max-width: 767px) {
        {% for target in targets %}
          {{ target | strip }} {
            {% if block.settings.font_url_mobile_landscape != blank and block.settings.font_family_name_mobile_landscape != blank %}
              font-family: "{{ block.settings.font_family_name_mobile_landscape }}", {{ block.settings.fallback_font }} !important;
            {% endif %}
            {% if block.settings.font_size_mobile_landscape != blank and block.settings.font_size_mobile_landscape > 10 %}
              font-size: {{ block.settings.font_size_mobile_landscape }}px !important;
            {% endif %}
            {% if block.settings.line_height_mobile_landscape != blank and block.settings.line_height_mobile_landscape != 1.5 %}
              line-height: {{ block.settings.line_height_mobile_landscape }} !important;
            {% endif %}
            {% if block.settings.letter_spacing_mobile_landscape != blank %}
              letter-spacing: {{ block.settings.letter_spacing_mobile_landscape }}px !important;
            {% endif %}
            {% if block.settings.font_weight_mobile_landscape != blank %}
              font-weight: {{ block.settings.font_weight_mobile_landscape }} !important;
            {% endif %}
          }
        {% endfor %}
      }

      {% comment %} Mobile Portrait (max-width: 479px) {% endcomment %}
      @media (max-width: 479px) {
        {% for target in targets %}
          {{ target | strip }} {
            {% if block.settings.font_url_mobile_portrait != blank and block.settings.font_family_name_mobile_portrait != blank %}
              font-family: "{{ block.settings.font_family_name_mobile_portrait }}", {{ block.settings.fallback_font }} !important;
            {% endif %}
            {% if block.settings.font_size_mobile_portrait != blank and block.settings.font_size_mobile_portrait > 10 %}
              font-size: {{ block.settings.font_size_mobile_portrait }}px !important;
            {% endif %}
            {% if block.settings.line_height_mobile_portrait != blank and block.settings.line_height_mobile_portrait != 1.5 %}
              line-height: {{ block.settings.line_height_mobile_portrait }} !important;
            {% endif %}
            {% if block.settings.letter_spacing_mobile_portrait != blank %}
              letter-spacing: {{ block.settings.letter_spacing_mobile_portrait }}px !important;
            {% endif %}
            {% if block.settings.font_weight_mobile_portrait != blank %}
              font-weight: {{ block.settings.font_weight_mobile_portrait }} !important;
            {% endif %}
          }
        {% endfor %}
      }
    {% endif %}
  {% endfor %}
</style>

{% if section.settings.show_preview %}
  <div class="font-override-preview" style="padding: 40px 20px; text-align: center; background: {{ section.settings.preview_bg }};">
    <div class="container">
      <h1 style="margin-bottom: 20px;">Heading 1 Preview</h1>
      <h2 style="margin-bottom: 20px;">Heading 2 Preview</h2>
      <h3 style="margin-bottom: 20px;">Heading 3 Preview</h3>
      <h4 style="margin-bottom: 20px;">Heading 4 Preview</h4>
      <h5 style="margin-bottom: 20px;">Heading 5 Preview</h5>
      <h6 style="margin-bottom: 20px;">Heading 6 Preview</h6>
      <p style="margin-bottom: 20px;">This is a paragraph preview. The quick brown fox jumps over the lazy dog.</p>
    </div>
  </div>
{% endif %}

{% schema %}
{
  "name": "Custom Font Override",
  "settings": [
    {
      "type": "header",
      "content": "Preview Settings"
    },
    {
      "type": "checkbox",
      "id": "show_preview",
      "label": "Show preview section",
      "default": false,
      "info": "Display a preview of all heading and paragraph styles"
    },
    {
      "type": "color",
      "id": "preview_bg",
      "label": "Preview background color",
      "default": "#f5f5f5"
    }
  ],
  "blocks": [
    {
      "type": "font_override",
      "name": "Font Override",
      "settings": [
        {
          "type": "header",
          "content": "Font Settings"
        },
        {
          "type": "text",
          "id": "font_url",
          "label": "Font URL",
          "info": "Paste the full Google Fonts URL or custom font file URL (.ttf, .otf, .woff, .woff2)",
          "placeholder": "https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
        },
        {
          "type": "text",
          "id": "font_family_name",
          "label": "Font Family Name",
          "info": "Enter the exact font family name (e.g., 'Roboto', 'Open Sans', 'Road Rage')",
          "placeholder": "Roboto"
        },
        {
          "type": "select",
          "id": "fallback_font",
          "label": "Fallback Font",
          "options": [
            {"value": "sans-serif", "label": "Sans-Serif"},
            {"value": "serif", "label": "Serif"},
            {"value": "monospace", "label": "Monospace"},
            {"value": "cursive", "label": "Cursive"}
          ],
          "default": "sans-serif"
        },
        {
          "type": "header",
          "content": "Target Elements"
        },
        {
          "type": "text",
          "id": "target_elements",
          "label": "CSS Selectors (comma separated)",
          "info": "Examples: h1,h2,h3 OR p OR .class-name OR #id-name",
          "default": "h1,h2,h3,h4,h5,h6",
          "placeholder": "h1,h2,h3,h4,h5,h6"
        },
        {
          "type": "header",
          "content": "Typography Settings"
        },
        {
          "type": "range",
          "id": "font_size",
          "label": "Font Size (px)",
          "min": 10,
          "max": 100,
          "step": 1,
          "default": 16,
          "info": "Set to default (16) to keep original size"
        },
        {
          "type": "range",
          "id": "line_height",
          "label": "Line Height",
          "min": 0.8,
          "max": 3.0,
          "step": 0.1,
          "default": 1.5,
          "info": "Set to default (1.5) to keep original line height"
        },
        {
          "type": "range",
          "id": "letter_spacing",
          "label": "Letter Spacing (px)",
          "min": -5,
          "max": 20,
          "step": 0.5,
          "default": 0
        },
        {
          "type": "select",
          "id": "font_weight",
          "label": "Font Weight",
          "options": [
            {"value": "", "label": "Default"},
            {"value": "100", "label": "100 - Thin"},
            {"value": "200", "label": "200 - Extra Light"},
            {"value": "300", "label": "300 - Light"},
            {"value": "400", "label": "400 - Normal"},
            {"value": "500", "label": "500 - Medium"},
            {"value": "600", "label": "600 - Semi Bold"},
            {"value": "700", "label": "700 - Bold"},
            {"value": "800", "label": "800 - Extra Bold"},
            {"value": "900", "label": "900 - Black"}
          ],
          "default": ""
        },
        {
          "type": "select",
          "id": "text_transform",
          "label": "Text Transform",
          "options": [
            {"value": "none", "label": "None"},
            {"value": "uppercase", "label": "UPPERCASE"},
            {"value": "lowercase", "label": "lowercase"},
            {"value": "capitalize", "label": "Capitalize"}
          ],
          "default": "none"
        },
        {
          "type": "header",
          "content": "Tablet (≤991px)"
        },
        {
          "type": "text",
          "id": "font_url_tablet",
          "label": "Tablet Font URL",
          "info": "Optional: Use a different font for tablets",
          "placeholder": "https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
        },
        {
          "type": "text",
          "id": "font_family_name_tablet",
          "label": "Tablet Font Family Name",
          "info": "Required if using tablet font URL",
          "placeholder": "Roboto"
        },
        {
          "type": "range",
          "id": "font_size_tablet",
          "label": "Font Size (px)",
          "min": 10,
          "max": 100,
          "step": 1,
          "default": 16,
          "info": "Leave at 16 to use desktop size"
        },
        {
          "type": "range",
          "id": "line_height_tablet",
          "label": "Line Height",
          "min": 0.8,
          "max": 3.0,
          "step": 0.1,
          "default": 1.5,
          "info": "Leave at 1.5 to use desktop line height"
        },
        {
          "type": "range",
          "id": "letter_spacing_tablet",
          "label": "Letter Spacing (px)",
          "min": -5,
          "max": 20,
          "step": 0.5,
          "default": 0
        },
        {
          "type": "select",
          "id": "font_weight_tablet",
          "label": "Font Weight",
          "options": [
            {"value": "", "label": "Use Desktop"},
            {"value": "100", "label": "100 - Thin"},
            {"value": "200", "label": "200 - Extra Light"},
            {"value": "300", "label": "300 - Light"},
            {"value": "400", "label": "400 - Normal"},
            {"value": "500", "label": "500 - Medium"},
            {"value": "600", "label": "600 - Semi Bold"},
            {"value": "700", "label": "700 - Bold"},
            {"value": "800", "label": "800 - Extra Bold"},
            {"value": "900", "label": "900 - Black"}
          ],
          "default": ""
        },
        {
          "type": "header",
          "content": "Mobile Landscape (≤767px)"
        },
        {
          "type": "text",
          "id": "font_url_mobile_landscape",
          "label": "Mobile Landscape Font URL",
          "info": "Optional: Use a different font for mobile landscape",
          "placeholder": "https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
        },
        {
          "type": "text",
          "id": "font_family_name_mobile_landscape",
          "label": "Mobile Landscape Font Family Name",
          "info": "Required if using mobile landscape font URL",
          "placeholder": "Roboto"
        },
        {
          "type": "range",
          "id": "font_size_mobile_landscape",
          "label": "Font Size (px)",
          "min": 10,
          "max": 100,
          "step": 1,
          "default": 16,
          "info": "Leave at 16 to use tablet size"
        },
        {
          "type": "range",
          "id": "line_height_mobile_landscape",
          "label": "Line Height",
          "min": 0.8,
          "max": 3.0,
          "step": 0.1,
          "default": 1.5,
          "info": "Leave at 1.5 to use tablet line height"
        },
        {
          "type": "range",
          "id": "letter_spacing_mobile_landscape",
          "label": "Letter Spacing (px)",
          "min": -5,
          "max": 20,
          "step": 0.5,
          "default": 0
        },
        {
          "type": "select",
          "id": "font_weight_mobile_landscape",
          "label": "Font Weight",
          "options": [
            {"value": "", "label": "Use Tablet"},
            {"value": "100", "label": "100 - Thin"},
            {"value": "200", "label": "200 - Extra Light"},
            {"value": "300", "label": "300 - Light"},
            {"value": "400", "label": "400 - Normal"},
            {"value": "500", "label": "500 - Medium"},
            {"value": "600", "label": "600 - Semi Bold"},
            {"value": "700", "label": "700 - Bold"},
            {"value": "800", "label": "800 - Extra Bold"},
            {"value": "900", "label": "900 - Black"}
          ],
          "default": ""
        },
        {
          "type": "header",
          "content": "Mobile Portrait (≤479px)"
        },
        {
          "type": "text",
          "id": "font_url_mobile_portrait",
          "label": "Mobile Portrait Font URL",
          "info": "Optional: Use a different font for mobile portrait",
          "placeholder": "https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
        },
        {
          "type": "text",
          "id": "font_family_name_mobile_portrait",
          "label": "Mobile Portrait Font Family Name",
          "info": "Required if using mobile portrait font URL",
          "placeholder": "Roboto"
        },
        {
          "type": "range",
          "id": "font_size_mobile_portrait",
          "label": "Font Size (px)",
          "min": 10,
          "max": 100,
          "step": 1,
          "default": 16,
          "info": "Leave at 16 to use mobile landscape size"
        },
        {
          "type": "range",
          "id": "line_height_mobile_portrait",
          "label": "Line Height",
          "min": 0.8,
          "max": 3.0,
          "step": 0.1,
          "default": 1.5,
          "info": "Leave at 1.5 to use mobile landscape line height"
        },
        {
          "type": "range",
          "id": "letter_spacing_mobile_portrait",
          "label": "Letter Spacing (px)",
          "min": -5,
          "max": 20,
          "step": 0.5,
          "default": 0
        },
        {
          "type": "select",
          "id": "font_weight_mobile_portrait",
          "label": "Font Weight",
          "options": [
            {"value": "", "label": "Use Mobile Landscape"},
            {"value": "100", "label": "100 - Thin"},
            {"value": "200", "label": "200 - Extra Light"},
            {"value": "300", "label": "300 - Light"},
            {"value": "400", "label": "400 - Normal"},
            {"value": "500", "label": "500 - Medium"},
            {"value": "600", "label": "600 - Semi Bold"},
            {"value": "700", "label": "700 - Bold"},
            {"value": "800", "label": "800 - Extra Bold"},
            {"value": "900", "label": "900 - Black"}
          ],
          "default": ""
        }
      ]
    }
  ],
  "max_blocks": 20,
  "presets": [
    {
      "name": "Custom Font Override",
      "blocks": [
        {
          "type": "font_override",
          "settings": {
            "target_elements": "h1,h2,h3,h4,h5,h6"
          }
        }
      ]
    }
  ]
}
{% endschema %}
