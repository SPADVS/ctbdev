{% stylesheet %}
  .ctb-testimonials {
    background: {{ section.settings.background_color }};
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px 0;
    color: {{ section.settings.text_color }};
  }

  .ctb-testimonials__inner {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .ctb-testimonials__title {
    text-align: center;
    color: {{ section.settings.heading_color }};
    font-size: clamp(2rem, 4vw, 3rem);
    margin: 0 0 2rem 0;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .ctb-testimonials__carousel {
    margin: 0 -10px;
  }

  .ctb-testimonial {
    background: {{ section.settings.card_background }};
    border: 1px solid {{ section.settings.card_border }};
    border-radius: 12px;
    padding: 1.5rem;
    min-height: 260px;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .ctb-testimonial:hover {
    transform: translateY(-4px);
    box-shadow: 0 25px 60px rgba(0, 0, 0, 0.35);
  }

  .ctb-testimonial__stars {
    color: {{ section.settings.star_color }};
    display: flex;
    gap: 0.25rem;
  }

  .ctb-testimonial__title {
    margin: 0;
    font-weight: 700;
    color: {{ section.settings.heading_color }};
  }

  .ctb-testimonial__body {
    margin: 0;
    color: {{ section.settings.text_color }};
    line-height: 1.6;
  }

  .ctb-testimonial__name {
    margin: 0;
    color: {{ section.settings.subtext_color }};
    font-weight: 600;
  }

  .ctb-testimonials .splide__pagination__page.is-active {
    background: {{ section.settings.accent_color }};
  }

  .ctb-testimonials .splide__arrow {
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.15);
    color: #f5f5f5;
  }

  .ctb-testimonials .splide__arrow:hover {
    border-color: {{ section.settings.accent_color }};
    color: {{ section.settings.accent_color }};
  }

  @media (max-width: 768px) {
    .ctb-testimonials {
      padding: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px 0 {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px 0;
    }

    .ctb-testimonial {
      padding: 1.25rem;
    }
  }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    const slider = document.querySelector('#ctb-testimonials-{{ section.id }} .ctb-testimonials__carousel');
    if (!slider || typeof Splide === 'undefined') return;

    const perPage = {{ section.settings.items_per_page }};

    const splide = new Splide(slider, {
      type: 'loop',
      gap: '20px',
      perPage: perPage,
      pagination: true,
      arrows: true,
      autoplay: {{ section.settings.autoplay | json }},
      interval: {{ section.settings.autoplay_speed }},
      speed: 700,
      pauseOnHover: true,
      breakpoints: {
        1024: { perPage: Math.max(perPage - 1, 1) },
        768: { perPage: 1 }
      }
    });

    splide.mount();
  });
{% endjavascript %}

<section id="ctb-testimonials-{{ section.id }}" class="ctb-testimonials">
  <div class="ctb-testimonials__inner">
    <h2 class="ctb-testimonials__title">{{ section.settings.heading }}</h2>

    <div class="ctb-testimonials__carousel splide" aria-label="Testimonials">
      <div class="splide__track">
        <ul class="splide__list">
          {% for block in section.blocks %}
            <li class="splide__slide">
              <article class="ctb-testimonial">
                {% if block.settings.rating > 0 %}
                  <div class="ctb-testimonial__stars" aria-label="{{ block.settings.rating }} star rating">
                    {% for i in (1..5) %}
                      {% if i <= block.settings.rating %}
                        <i class="fas fa-star"></i>
                      {% else %}
                        <i class="far fa-star"></i>
                      {% endif %}
                    {% endfor %}
                  </div>
                {% endif %}

                {% if block.settings.title != blank %}
                  <p class="ctb-testimonial__title">{{ block.settings.title }}</p>
                {% endif %}

                {% if block.settings.testimonial != blank %}
                  <p class="ctb-testimonial__body">“{{ block.settings.testimonial }}”</p>
                {% endif %}

                {% if block.settings.customer_name != blank %}
                  <p class="ctb-testimonial__name">— {{ block.settings.customer_name }}</p>
                {% endif %}
              </article>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "CTB Testimonials (Black)",
  "settings": [
    {"type": "text", "id": "heading", "label": "Heading", "default": "What Customers Are Saying"},
    {"type": "range", "id": "items_per_page", "label": "Items per view", "min": 1, "max": 4, "step": 1, "default": 3},
    {"type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": true},
    {"type": "range", "id": "autoplay_speed", "min": 3000, "max": 12000, "step": 500, "unit": "ms", "label": "Autoplay speed", "default": 5500},
    {"type": "range", "id": "padding_top", "min": 20, "max": 140, "step": 10, "unit": "px", "label": "Padding Top", "default": 70},
    {"type": "range", "id": "padding_bottom", "min": 20, "max": 140, "step": 10, "unit": "px", "label": "Padding Bottom", "default": 70},
    {"type": "color", "id": "background_color", "label": "Background", "default": "#060606"},
    {"type": "color", "id": "heading_color", "label": "Heading Color", "default": "#f5f5f5"},
    {"type": "color", "id": "text_color", "label": "Text Color", "default": "#e6e6e6"},
    {"type": "color", "id": "subtext_color", "label": "Subtext Color", "default": "#bdbdbd"},
    {"type": "color", "id": "card_background", "label": "Card Background", "default": "#0f0f0f"},
    {"type": "text", "id": "card_border", "label": "Card Border", "default": "1px solid #1d1d1d"},
    {"type": "color", "id": "star_color", "label": "Star Color", "default": "#f5d76e"},
    {"type": "color", "id": "accent_color", "label": "Accent Color", "default": "#f5d76e"}
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {"type": "range", "id": "rating", "label": "Rating", "min": 0, "max": 5, "step": 1, "default": 5},
        {"type": "text", "id": "title", "label": "Short title", "default": "Excellent auto body work!"},
        {"type": "textarea", "id": "testimonial", "label": "Testimonial text", "default": "CTB Garage did an amazing job on my car's body repair. Paint match was perfect and they finished ahead of schedule."},
        {"type": "text", "id": "customer_name", "label": "Customer name", "default": "Mike T., Chicago"}
      ]
    }
  ],
  "presets": [
    {
      "name": "CTB Testimonials (Black)",
      "blocks": [
        {"type": "testimonial"},
        {"type": "testimonial", "settings": {"title": "Professional service!", "testimonial": "They know their stuff and take pride in their work. My car looks brand new.", "customer_name": "Sarah L., Illinois"}},
        {"type": "testimonial", "settings": {"title": "Love the apparel!", "testimonial": "Their apparel line is fire. Wearing my hoodie to every meet now.", "customer_name": "Carlos R."}}
      ]
    }
  ]
}
{% endschema %}
