{% comment %}
  Section: Product Slider Tabs
  This section displays product sliders in a tabbed interface.
  Each tab (defined as a block) lets you choose a collection and a tab title.
  The slider is built using Splide and is only initialized and animated when its tab is active.
{% endcomment %}

<!-- Tabbed Section Container -->
<section class="product-slider-tabs">
  <div class="container">
    <div class="column-list _20">
      <h2 class="heading-md"><strong>{{ section.settings.heading }}</strong></h2>
      <div class="uui-text-size-medium">
        {{ section.settings.description }}
      </div>
    </div>
    
    <!-- Tab Buttons -->
    <div class="tabs-buttons" style="display:flex; gap:1rem; margin-bottom:1rem;">
      {% for block in section.blocks %}
        <button class="tab-button {% if forloop.first %}active{% endif %}" data-tab="{{ forloop.index0 }}">
          {{ block.settings.tab_title }}
        </button>
      {% endfor %}
    </div>
    
    <!-- Tab Contents -->
    <div class="tabs-content">
      {% for block in section.blocks %}
        <div class="tab-content {% if forloop.first %}active{% else %}hide{% endif %}" data-tab-content="{{ forloop.index0 }}">
          <div class="slider-wrapper">
            <div class="splide" data-auto-scroll-speed="{{ section.settings.auto_scroll_speed }}">
              <div class="splide__track">
                <div class="splide__list">
                  {% assign products = collections[block.settings.collection].products %}
                  {% if products.size > 0 %}
                    {% for product in products %}
                      <div class="splide__slide">
                        <a href="{{ product.url }}" class="prorduct-wrapper">
                          <div class="relative rounded-20">
                            <div class="background-4">
                              <div class="bg-image-3">
                                <img class="product-image" 
                                     src="{{ product.featured_image | img_url: '500x' }}" 
                                     alt="{{ product.title }}" 
                                     loading="lazy">
                              </div>
                            </div>
                            <div class="card-image-2"></div>
                          </div>
                          <div class="horizontal-between-center">
                            <div class="product-info">
                              <div class="price">
                                <div class="pricing-2">
                                  <small class="starting-at"><em>starting at</em></small>{{ product.price | money }}
                                </div>
                              </div>
                              <div class="product-name">{{ product.title }}</div>
                            </div>
                          </div>
                        </a>
                      </div>
                    {% endfor %}
                  {% else %}
                    <p>No products found in this collection.</p>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</section>

<!-- CSS: Updated Styles -->
<style>
  /* Outer text: white */
  .heading-md, 
  .uui-text-size-medium {
    color: #fff;
  }
  /* Tab Buttons: White outline, transparent background, white text */
  .tab-button {
    background: transparent;
    border: 1px solid #fff;
    color: #fff;
    padding: 0.5rem 1rem;
    cursor: pointer;
    transition: background 0.3s;
  }
  .tab-button:hover, .tab-button.active {
       background: rgb(7 53 41);
  }
  /* Hidden tab content */
  .tab-content.hide {
    display: none;
  }
  /* Additional CSS from your style */
  .subheading {
    grid-column-gap: 1rem;
    grid-row-gap: 1rem;
    align-items: center;
    display: flex;
  }
  .splide__list {
    grid-column-gap: 32px;
    flex: none;
    display: flex;
    -webkit-user-select: none;  /* Chrome, Safari, Opera */
    -moz-user-select: none;     /* Firefox */
    -ms-user-select: none;      /* Internet Explorer/Edge */
    user-select: none;          /* Standard syntax */
    -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
  }
  .card-image-2 {
    z-index: -10;
    filter: invert();
    object-fit: contain;
    width: 250px;
    height: 200px;
    padding: 24px 40px;
    position: relative;
  }
  .brands-card-2 {
    color: #2c2c2c;
    justify-content: center;
    align-self: stretch;
    align-items: center;
    min-width: 22rem;
    min-height: 8rem;
    padding: 1rem;
    display: flex;
  }
  .slider-wrapper {
    padding-top: 16px;
  }
  .brands-list-2 {
    z-index: 20;
    color: #2c2c2c;
    grid-template-rows: auto;
    grid-template-columns: 1fr 1fr;
    grid-auto-columns: 1fr;
    align-items: end;
    max-width: 100%;
    padding-top: 2rem;
    padding-bottom: 2rem;
    display: flex;
    position: relative;
    overflow: hidden;
  }
  .pricing-2 {
    color: #fff;
    font-size: 1.1rem;
    line-height: 1.5;
    text-decoration: none;
    display: block;
  }
  .pricing-2 .starting-at {
    font-size: 0.6em;
    font-style: italic;
    margin-right: 0.25rem;
    color: #fff;
  }
  .bg-image-3 {
    width: 100%;
    height: 100%;
    overflow: clip;
    transform: none;
  }
  .product-name {
    color: #fff8ee;
    font-size: .78rem;
    font-weight: 800;
    line-height: 1.5;
  }
  .splide__slide {
    perspective-origin: 50% 100%;
    transform-origin: 50% 100%;
    background-color: #000;
    border: 1px solid #fff;
    border-radius: 3px;
    flex-direction: column;
    width: 278px;
    padding: 14px;
    transition: all 0.2s;
    display: flex;
    box-shadow: 0 2px 5px rgba(255, 255, 255, 0.24);
  }
  .splide__slide:hover {
    transform: scale(1.05);
  }
  span.splide__sr {
    display: none;
  }
  .price {
    grid-column-gap: 16px;
    grid-row-gap: 16px;
    flex-flow: column;
    grid-template-rows: auto auto;
    grid-template-columns: 1fr 1fr;
    grid-auto-columns: 1fr;
    justify-content: space-between;
    align-items: flex-end;
    font-weight: 300;
    display: flex;
  }
  .product-image {
    object-fit: cover;
    object-position: 50% 50%;
    background-image: linear-gradient(#000, transparent 50%, #000);
    width: 100%;
    max-width: none;
    height: 100%;
    position: absolute;
    overflow: visible;
  }
  .horizontal-between-center {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    padding-top: 15px;
    display: block;
  }
  .relative {
    position: relative;
  }
  .relative.rounded-20 {
       border-radius: 20px;
       overflow: hidden;
       height: 265px;
       width: 100%;
  }
  .column-list {
    grid-column-gap: 1rem;
    grid-row-gap: 1rem;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    display: flex;
  }
  .container {
    flex-direction: column;
    align-items: flex-start;
    width: 100%;
    max-width: 1440px;
    margin-bottom: 10%;
    padding-left: 2rem;
    padding-right: 2rem;
    display: flex;
    position: relative;
  }
  .heading-md {
    text-align: left;
    text-transform: capitalize;
    padding-top: 11px;
    padding-bottom: 11px;
    font-size: 2.5rem;
    font-weight: 900;
  }
  /* Slider Animation Styles */
  .splide {
    opacity: 0;
    transform: translateY(50px);
    transition: opacity .3s ease-out, transform .3s ease-out;
  }
  .splide.in-view {
    opacity: 1;
    transform: translateY(0);
  }
  .splide.slider-animate {
    transition-delay: 0.3s;
  }
  .splide__slide {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.2s ease-out, transform 0.2s ease-out;
  }
  .splide__slide.animate-slide {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.2s ease-out, transform 0.2s ease-out;
  }
  .splide.all-visible .splide__slide {
    opacity: 1 !important;
    transform: none !important;
    transition: none !important;
  }
  .shop-now-button {
    border: 0.5px solid #8d8d8d;
    transition: all 0.2s;
    color: white;
    background: black;
  }
  .shop-now-button :hover {
    transform: scale(1.05);
    color: black;
    background: white;
  }
</style>

<!-- JavaScript: Tab switching, slider initialization, and animation -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  // Scope everything within the Product Slider Tabs section
  var productSliderTabs = document.querySelector('.product-slider-tabs');
  if (!productSliderTabs) return;

  // Function to animate the slider slides (now including clones)
  function animateSplide(splideElement) {
    splideElement.classList.add('in-view', 'slider-animate');
    var slides = splideElement.querySelectorAll('.splide__slide');
    slides.forEach(function(slide, index) {
      setTimeout(function() {
        slide.classList.add('animate-slide');
      }, index * 80);
    });
    var totalDelay = slides.length * 80 + 150;
    setTimeout(function() {
      splideElement.classList.add('all-visible');
    }, totalDelay);
  }

  // Function to initialize Splide on a given element if not already initialized.
  function initSplide(splideElement) {
    if(splideElement && !splideElement.classList.contains('splide-initialized')) {
      var autoScrollSpeed = parseInt(splideElement.getAttribute('data-auto-scroll-speed')) || 1;
      var splideInstance = new Splide(splideElement, {
        type: 'loop',
        autoWidth: true,
        height: 'auto',
        drag: 'free',
        arrows: false,
        pagination: false,
        label: 'Image Slider',
        autoScroll: {
          speed: autoScrollSpeed,
          pauseOnHover: false,
          pauseOnFocus: false,
        },
        breakpoints: {
          991: { autoScroll: { speed: autoScrollSpeed } },
          767: { autoScroll: { speed: autoScrollSpeed } }
        }
      });
      splideInstance.mount(window.splide.Extensions);
      splideElement.classList.add('splide-initialized');
      console.log('Initialized Splide for', splideElement);
      // Trigger the animation once mounted.
      animateSplide(splideElement);
    } else if(splideElement) {
      // Re-run the animation on tab activation.
      splideElement.classList.remove('in-view', 'slider-animate', 'all-visible');
      var slides = splideElement.querySelectorAll('.splide__slide');
      slides.forEach(function(slide){
        slide.classList.remove('animate-slide');
      });
      animateSplide(splideElement);
    }
  }

  // Tab button click event listener (scoped to our section)
  var tabButtons = productSliderTabs.querySelectorAll('.tab-button');
  tabButtons.forEach(function(button) {
    button.addEventListener('click', function() {
      var tabId = button.getAttribute('data-tab');
      // Remove active class from all buttons and hide all tab contents.
      productSliderTabs.querySelectorAll('.tab-button').forEach(function(b) { b.classList.remove('active'); });
      productSliderTabs.querySelectorAll('.tab-content').forEach(function(content) { 
        content.classList.remove('active');
        content.classList.add('hide'); 
      });
      // Set the clicked button and corresponding content as active.
      button.classList.add('active');
      var activeContent = productSliderTabs.querySelector('.tab-content[data-tab-content="'+ tabId +'"]');
      if(activeContent) {
        activeContent.classList.remove('hide');
        activeContent.classList.add('active');
        // Initialize and animate the Splide slider in the active tab.
        var splideElement = activeContent.querySelector('.splide');
        initSplide(splideElement);
      }
    });
  });

  // Initialize the first tab's slider on page load.
  var firstTabContent = productSliderTabs.querySelector('.tab-content.active');
  if(firstTabContent) {
    var splideElement = firstTabContent.querySelector('.splide');
    initSplide(splideElement);
  }
});
</script>

{% schema %}
{
  "name": "Product Slider Tabs",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Rep Your Business"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Show off your love for quality auto parts with exclusive products From tees and hats to shop gear, weâ€™ve got something for every car enthusiast."
    },
    {
      "type": "range",
      "id": "auto_scroll_speed",
      "label": "Auto Scroll Speed",
      "default": 1,
      "min": 1,
      "max": 10,
      "step": 1
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        {
          "type": "text",
          "id": "tab_title",
          "label": "Tab Title",
          "default": "Tab 1"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Product Slider Tabs",
      "category": "Custom"
    }
  ]
}
{% endschema %}
